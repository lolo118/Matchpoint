<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Torneos de Pádel - Matchpoint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .group-card {
            transition: transform 0.2s ease-in-out;
        }
        .group-card:hover {
            transform: translateY(-2px);
        }
        .tab-active {
            background-color: #374151;
            border-color: #ef4444;
            color: white;
        }
        .search-highlight {
            background-color: #fef3c7;
            color: #92400e;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tournament-card {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            border: 1px solid #4b5563;
        }
    </style>
</head>
<body class="text-gray-300">

    <div id="app" class="container mx-auto p-4 md:p-6 max-w-7xl">
        <!-- Header -->
        <header class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 shadow-lg rounded-xl p-4 md:p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1 class="text-2xl md:text-4xl font-extrabold text-white tracking-tight">Matchpoint</h1>
                    <p id="tournament-title" class="text-gray-400 text-sm md:text-base mt-1">Cargando torneo...</p>
                </div>
                
                <!-- User Auth Section -->
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div id="user-info" class="hidden items-center space-x-2">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                            <span id="user-initials"></span>
                        </div>
                        <span id="user-name" class="text-white font-medium"></span>
                        <button id="user-logout" class="text-gray-400 hover:text-white text-sm">Cerrar Sesión</button>
                    </div>
                    <button id="user-login-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                        Acceso Jugadores
                    </button>
                </div>
                
                <!-- Quick Group Links -->
                <div id="group-links" class="flex flex-wrap justify-center gap-2">
                    <!-- Los enlaces se generarán dinámicamente -->
                </div>
            </div>
            
            <!-- Search Bar -->
            <div class="mt-4 w-full md:w-2/3 mx-auto">
                <div class="relative">
                    <input type="text" id="player-search" placeholder="Buscar jugador por apellido..." 
                           class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                    <svg class="absolute right-3 top-2.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                    </svg>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="content-area">
            <!-- Tournament Overview -->
            <section id="tournament-overview" class="mb-8">
                <div class="tournament-card rounded-xl p-6 shadow-lg">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-white" id="overview-tournament-name">Torneo de Pádel</h2>
                            <div class="flex flex-wrap gap-4 mt-2 text-sm">
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span id="overview-date" class="text-gray-300">Fecha por definir</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    <span id="overview-teams" class="text-gray-300">0 parejas</span>
                                </div>
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                    <span id="overview-courts" class="text-gray-300">0 canchas</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <div class="bg-gray-800 rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-white" id="overview-groups">0</div>
                                <div class="text-xs text-gray-400">Grupos</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div id="player-view" class="space-y-8">
                <!-- Group Standings -->
                <section id="groups-section">
                    <h2 class="text-2xl font-bold mb-4 text-center text-white flex items-center justify-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        Clasificación de Grupos
                    </h2>
                    <div id="groups-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                        <!-- JS will inject group cards -->
                    </div>
                </section>

                <!-- Match Schedule -->
                <section id="schedule-section">
                    <h2 class="text-2xl font-bold mb-4 text-center text-white flex items-center justify-center gap-3">
                       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        Programa de Partidos
                    </h2>
                    <div id="schedule-container" class="space-y-3">
                       <!-- JS will inject schedule items -->
                    </div>
                </section>

                 <!-- Knockout Stage -->
                <section id="knockout-section" class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-center text-white">Fase Eliminatoria</h2>
                    <div class="flex flex-col md:flex-row md:justify-around space-y-8 md:space-y-0 md:space-x-4">
                        <!-- JS will inject knockout rounds -->
                    </div>
                </section>
            </div>

            <!-- Admin View -->
            <div id="admin-view" class="hidden mt-8">
                <!-- Admin Tabs -->
                <div class="border-b border-gray-700 mb-6">
                    <nav class="flex -mb-px">
                        <button id="tab-tournament" class="tab-active py-2 px-4 font-medium text-sm border-b-2 border-red-500 text-white">
                            Torneo
                        </button>
                        <button id="tab-players" class="py-2 px-4 font-medium text-sm border-b-2 border-transparent text-gray-400 hover:text-white">
                            Parejas
                        </button>
                        <button id="tab-matches" class="py-2 px-4 font-medium text-sm border-b-2 border-transparent text-gray-400 hover:text-white">
                            Partidos
                        </button>
                    </nav>
                </div>
                
                <!-- Tournament Tab -->
                <div id="tab-content-tournament" class="tab-content">
                    <section class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Configuración del Torneo</h2>
                        
                        <div class="bg-gray-900 border border-gray-700 p-4 rounded-lg mb-6">
                            <h3 class="text-xl font-bold mb-4 text-white">Información General</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Nombre del Torneo</label>
                                    <input type="text" id="tournament-name" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Ej: Torneo 8va Categoría Masculino">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Fecha</label>
                                    <input type="date" id="tournament-date" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Cantidad de Canchas</label>
                                    <input type="number" id="court-count" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" min="1" max="10" value="4">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Cantidad de Grupos</label>
                                    <select id="group-count" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500">
                                        <option value="4">4 Grupos</option>
                                        <option value="6">6 Grupos</option>
                                        <option value="8" selected>8 Grupos</option>
                                    </select>
                                </div>
                                <div class="md:col-span-2 flex items-end">
                                    <button id="save-tournament-settings" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">Guardar Configuración</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-900 border border-gray-700 p-4 rounded-lg">
                            <h3 class="text-xl font-bold mb-4 text-white">Acciones del Torneo</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button id="generate-groups" class="bg-yellow-600 text-white font-bold py-3 rounded-lg hover:bg-yellow-700 transition-colors">Generar Grupos Automáticamente</button>
                                <button id="generate-knockout" class="bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition-colors">Generar Fase Eliminatoria</button>
                                <button id="reset-tournament" class="bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-colors">Reiniciar Torneo</button>
                                <button id="export-tournament" class="bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors">Exportar Datos</button>
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- Players Tab -->
                <div id="tab-content-players" class="tab-content hidden">
                    <section class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Gestionar Parejas</h2>
                        
                        <!-- Add Player Form -->
                        <div class="bg-gray-900 border border-gray-700 p-4 rounded-lg mb-6">
                            <h3 class="text-xl font-bold mb-4 text-white">Agregar Nueva Pareja</h3>
                            <form id="add-player-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Jugador 1</label>
                                    <input type="text" id="player1-name" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Apellido, Nombre" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Jugador 2</label>
                                    <input type="text" id="player2-name" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Apellido, Nombre" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Nombre de Pareja</label>
                                    <input type="text" id="team-name" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Apellido1 - Apellido2" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Grupo</label>
                                    <select id="player-group" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                        <option value="">Seleccionar Grupo</option>
                                        <!-- Los grupos se generarán dinámicamente -->
                                    </select>
                                </div>
                                <div class="md:col-span-2">
                                    <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors">Agregar Pareja</button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Players List -->
                        <div class="bg-gray-900 border border-gray-700 p-4 rounded-lg">
                            <h3 class="text-xl font-bold mb-4 text-white">Parejas Registradas</h3>
                            <div id="players-list" class="space-y-3">
                                <!-- JS will inject players list -->
                            </div>
                        </div>
                    </section>
                </div>
                
                <!-- Matches Tab -->
                <div id="tab-content-matches" class="tab-content hidden">
                    <section id="admin-matches-section" class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Actualizar Resultados</h2>
                        <div id="admin-matches-container" class="space-y-4">
                            <!-- JS will inject admin forms -->
                        </div>
                    </section>
                    
                    <!-- Add Match Section -->
                    <section id="add-match-section" class="bg-gray-800 p-4 md:p-6 rounded-xl shadow-md mt-6">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Agregar Partido</h2>
                        <form id="add-match-form" class="bg-gray-900 border border-gray-700 p-4 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Grupo</label>
                                    <select id="new-match-group" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                        <option value="">Seleccionar Grupo</option>
                                        <!-- Los grupos se generarán dinámicamente -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Cancha</label>
                                    <input type="number" id="new-match-court" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" min="1" max="10" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Hora</label>
                                    <input type="time" id="new-match-time" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Pareja 1</label>
                                    <select id="new-match-team1" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                        <option value="">Seleccionar Pareja</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Pareja 2</label>
                                    <select id="new-match-team2" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                        <option value="">Seleccionar Pareja</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors">Agregar Partido</button>
                        </form>
                    </section>
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <button id="admin-login-btn" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm md:text-base mb-4">
                Acceso Administrador
            </button>
            <button id="logout-btn" class="hidden bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm md:text-base mb-4">
                Cerrar Sesión Admin
            </button>
            <p>&copy; 2025 Matchpoint. Todos los derechos reservados.</p>
        </footer>
    </div>

    <!-- Admin Login Modal -->
    <div id="login-modal" class="modal-overlay fixed inset-0 bg-black/80 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-xl shadow-2xl p-8 w-full max-w-sm relative">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">&times;</button>
            <h2 class="text-2xl font-bold text-center mb-2 text-white">Acceso Admin</h2>
            <p class="text-center text-gray-400 mb-6">Ingresa tus credenciales.</p>
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-gray-300 mb-1">Usuario</label>
                    <input type="text" id="username" name="username" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-1">Contraseña</label>
                    <input type="password" id="password" name="password" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-red-500" required>
                </div>
                <p id="login-error" class="text-red-500 text-sm text-center mb-4 hidden">Usuario o contraseña incorrectos.</p>
                <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500">Ingresar</button>
            </form>
        </div>
    </div>

    <!-- User Login/Register Modal -->
    <div id="user-auth-modal" class="modal-overlay fixed inset-0 bg-black/80 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-xl shadow-2xl p-8 w-full max-w-sm relative">
            <button id="close-user-modal-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">&times;</button>
            
            <!-- Login Form -->
            <div id="user-login-form">
                <h2 class="text-2xl font-bold text-center mb-2 text-white">Acceso Jugadores</h2>
                <p class="text-center text-gray-400 mb-6">Ingresa a tu cuenta</p>
                <form id="login-user-form">
                    <div class="mb-4">
                        <label for="user-email" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                        <input type="email" id="user-email" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="user-password" class="block text-sm font-medium text-gray-300 mb-1">Contraseña</label>
                        <input type="password" id="user-password" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <p id="user-login-error" class="text-red-500 text-sm text-center mb-4 hidden">Email o contraseña incorrectos.</p>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">Ingresar</button>
                </form>
                <p class="text-center text-gray-400 mt-4">
                    ¿No tienes cuenta? <button id="go-to-register" class="text-blue-400 hover:text-blue-300">Regístrate</button>
                </p>
            </div>
            
            <!-- Register Form -->
            <div id="user-register-form" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-2 text-white">Crear Cuenta</h2>
                <p class="text-center text-gray-400 mb-6">Regístrate como jugador</p>
                <form id="register-user-form">
                    <div class="mb-4">
                        <label for="register-name" class="block text-sm font-medium text-gray-300 mb-1">Nombre Completo</label>
                        <input type="text" id="register-name" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                        <input type="email" id="register-email" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="register-password" class="block text-sm font-medium text-gray-300 mb-1">Contraseña</label>
                        <input type="password" id="register-password" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label for="register-password-confirm" class="block text-sm font-medium text-gray-300 mb-1">Confirmar Contraseña</label>
                        <input type="password" id="register-password-confirm" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <p id="user-register-error" class="text-red-500 text-sm text-center mb-4 hidden"></p>
                    <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition-colors">Registrarse</button>
                </form>
                <p class="text-center text-gray-400 mt-4">
                    ¿Ya tienes cuenta? <button id="go-to-login" class="text-blue-400 hover:text-blue-300">Inicia sesión</button>
                </p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DATA (Inicialmente vacía, se llena a través del admin) ---
            let tournamentData = {
                settings: {
                    name: 'Torneo de Pádel',
                    date: new Date().toISOString().split('T')[0],
                    courts: 4,
                    groups: 8
                },
                groups: {},
                matches: [],
                knockout: {
                    rounds: [
                        { name: 'Octavos de Final', matches: [] },
                        { name: 'Cuartos de Final', matches: [] },
                        { name: 'Semifinal', matches: [] },
                        { name: 'Final', matches: [] }
                    ]
                }
            };

            // Datos de usuarios (jugadores)
            let users = [];

            // Inicializar grupos basados en la configuración
            function initializeGroups() {
                tournamentData.groups = {};
                const groupCount = tournamentData.settings.groups;
                const groupLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
                
                for (let i = 0; i < groupCount; i++) {
                    tournamentData.groups[groupLetters[i]] = [];
                }
            }

            // Cargar datos del localStorage si existen
            function loadFromLocalStorage() {
                const savedData = localStorage.getItem('tournamentData');
                if (savedData) {
                    tournamentData = JSON.parse(savedData);
                } else {
                    initializeGroups();
                }
                
                const savedUsers = localStorage.getItem('tournamentUsers');
                if (savedUsers) {
                    users = JSON.parse(savedUsers);
                }
            }

            // Guardar datos en localStorage
            function saveToLocalStorage() {
                localStorage.setItem('tournamentData', JSON.stringify(tournamentData));
                localStorage.setItem('tournamentUsers', JSON.stringify(users));
            }

            // --- DOM ELEMENTS ---
            const groupsGrid = document.getElementById('groups-grid');
            const scheduleContainer = document.getElementById('schedule-container');
            const knockoutContainer = document.querySelector('#knockout-section > div');
            const adminView = document.getElementById('admin-view');
            const adminMatchesContainer = document.getElementById('admin-matches-container');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const loginModal = document.getElementById('login-modal');
            const loginForm = document.getElementById('login-form');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const loginError = document.getElementById('login-error');
            const addMatchForm = document.getElementById('add-match-form');
            const newMatchGroup = document.getElementById('new-match-group');
            const newMatchTeam1 = document.getElementById('new-match-team1');
            const newMatchTeam2 = document.getElementById('new-match-team2');
            const playerSearch = document.getElementById('player-search');
            const addPlayerForm = document.getElementById('add-player-form');
            const playersList = document.getElementById('players-list');
            const tabMatches = document.getElementById('tab-matches');
            const tabPlayers = document.getElementById('tab-players');
            const tabTournament = document.getElementById('tab-tournament');
            const tabContentMatches = document.getElementById('tab-content-matches');
            const tabContentPlayers = document.getElementById('tab-content-players');
            const tabContentTournament = document.getElementById('tab-content-tournament');
            const generateGroupsBtn = document.getElementById('generate-groups');
            const resetTournamentBtn = document.getElementById('reset-tournament');
            const saveTournamentSettingsBtn = document.getElementById('save-tournament-settings');
            const generateKnockoutBtn = document.getElementById('generate-knockout');
            const exportTournamentBtn = document.getElementById('export-tournament');
            const groupLinks = document.getElementById('group-links');
            const tournamentTitle = document.getElementById('tournament-title');
            const overviewTournamentName = document.getElementById('overview-tournament-name');
            const overviewDate = document.getElementById('overview-date');
            const overviewTeams = document.getElementById('overview-teams');
            const overviewCourts = document.getElementById('overview-courts');
            const overviewGroups = document.getElementById('overview-groups');
            
            // User auth elements
            const userAuthModal = document.getElementById('user-auth-modal');
            const userLoginBtn = document.getElementById('user-login-btn');
            const closeUserModalBtn = document.getElementById('close-user-modal-btn');
            const userLoginForm = document.getElementById('user-login-form');
            const userRegisterForm = document.getElementById('user-register-form');
            const loginUserForm = document.getElementById('login-user-form');
            const registerUserForm = document.getElementById('register-user-form');
            const goToRegister = document.getElementById('go-to-register');
            const goToLogin = document.getElementById('go-to-login');
            const userLoginError = document.getElementById('user-login-error');
            const userRegisterError = document.getElementById('user-register-error');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const userInitials = document.getElementById('user-initials');
            const userLogout = document.getElementById('user-logout');

            // --- RENDER FUNCTIONS ---
            function renderTournamentOverview() {
                // Actualizar información del torneo
                tournamentTitle.textContent = tournamentData.settings.name;
                overviewTournamentName.textContent = tournamentData.settings.name;
                
                // Formatear fecha
                const date = new Date(tournamentData.settings.date);
                overviewDate.textContent = date.toLocaleDateString('es-ES', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Contar parejas
                let totalTeams = 0;
                for (const group in tournamentData.groups) {
                    totalTeams += tournamentData.groups[group].length;
                }
                overviewTeams.textContent = `${totalTeams} pareja${totalTeams !== 1 ? 's' : ''}`;
                
                // Información de canchas y grupos
                overviewCourts.textContent = `${tournamentData.settings.courts} cancha${tournamentData.settings.courts !== 1 ? 's' : ''}`;
                overviewGroups.textContent = Object.keys(tournamentData.groups).length;
                
                // Actualizar enlaces rápidos a grupos
                renderGroupLinks();
            }
            
            function renderGroupLinks() {
                groupLinks.innerHTML = '';
                for (const groupName in tournamentData.groups) {
                    const link = document.createElement('a');
                    link.href = `#group-${groupName}`;
                    link.className = 'px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-md text-sm transition-colors';
                    link.textContent = groupName;
                    groupLinks.appendChild(link);
                }
            }

            function renderGroups() {
                groupsGrid.innerHTML = '';
                for (const groupName in tournamentData.groups) {
                    const groupData = tournamentData.groups[groupName];
                    const groupCard = document.createElement('div');
                    groupCard.className = 'bg-gray-800 border border-gray-700 p-4 rounded-lg group-card fade-in';
                    groupCard.id = `group-${groupName}`;
                    
                    // Ordenar por puntos (desc) y diferencia de games (desc)
                    const sortedGroup = [...groupData].sort((a, b) => {
                        if (b.Pts !== a.Pts) return b.Pts - a.Pts;
                        return b.DG - a.DG;
                    });
                    
                    let teamsHTML = `<h3 class="font-bold text-xl mb-4 text-white text-center border-b border-gray-700 pb-2">Grupo ${groupName}</h3>
                                     <div class="space-y-2">`;
                    
                    if (sortedGroup.length === 0) {
                        teamsHTML += `<div class="text-center text-gray-500 py-4">No hay parejas en este grupo</div>`;
                    } else {
                        sortedGroup.forEach((team, index) => {
                            const positionClass = index === 0 ? 'border-green-500' : 
                                                index === 1 ? 'border-yellow-500' : 'border-gray-600';
                            
                            teamsHTML += `<div class="bg-gray-900 rounded-lg p-3 border-l-4 ${positionClass}">
                                            <div class="flex justify-between items-center">
                                                <span class="font-bold text-sm text-white truncate pr-2">${team.name}</span>
                                                <span class="font-bold text-lg ${index === 0 ? 'text-green-400' : index === 1 ? 'text-yellow-400' : 'text-red-400'} flex-shrink-0">${team.Pts} Pts</span>
                                            </div>
                                            <div class="grid grid-cols-4 gap-1 text-center text-xs mt-2 text-gray-400">
                                                <div><span class="font-semibold text-gray-200">${team.PJ}</span> PJ</div>
                                                <div><span class="font-semibold text-gray-200">${team.PG}</span> PG</div>
                                                <div><span class="font-semibold text-gray-200">${team.PP}</span> PP</div>
                                                <div><span class="font-semibold text-gray-200">${team.DG > 0 ? '+' : ''}${team.DG}</span> DG</div>
                                            </div>
                                          </div>`;
                        });
                    }
                    teamsHTML += `</div>`;
                    groupCard.innerHTML = teamsHTML;
                    groupsGrid.appendChild(groupCard);
                }
            }

            function renderSchedule() {
                scheduleContainer.innerHTML = '';
                
                if (tournamentData.matches.length === 0) {
                    scheduleContainer.innerHTML = `<div class="text-center text-gray-500 py-8">No hay partidos programados</div>`;
                    return;
                }
                
                // Agrupar partidos por grupo
                const matchesByGroup = {};
                tournamentData.matches.forEach(match => {
                    if (!matchesByGroup[match.group]) {
                        matchesByGroup[match.group] = [];
                    }
                    matchesByGroup[match.group].push(match);
                });
                
                // Renderizar partidos por grupo
                for (const groupName in matchesByGroup) {
                    const groupMatches = matchesByGroup[groupName];
                    
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'mt-6 mb-3 fade-in';
                    groupHeader.innerHTML = `<h3 class="text-lg font-bold text-white border-l-4 border-red-500 pl-2">Grupo ${groupName}</h3>`;
                    scheduleContainer.appendChild(groupHeader);
                    
                    groupMatches.forEach(match => {
                        const matchElement = document.createElement('div');
                        const statusClass = match.completed ? 'border-green-500' : 'border-blue-500';
                        const statusText = match.completed ? 'Finalizado' : 'Pendiente';
                        matchElement.className = `p-3 rounded-lg flex flex-col sm:flex-row items-center justify-between bg-gray-800 border-l-4 ${statusClass} transition-transform hover:scale-[1.02] mb-2 fade-in`;
                        
                        let scoreHTML = `<div class="text-xl font-bold text-gray-400 my-2 sm:my-0">VS</div>`;
                        if (match.completed) {
                            scoreHTML = `<div class="text-center my-2 sm:my-0"><span class="text-3xl font-bold text-white">${match.score1} - ${match.score2}</span><div class="text-xs text-gray-400">Final</div></div>`;
                        }

                        matchElement.innerHTML = `
                            <div class="flex-1 w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 text-center">
                                <div class="font-bold text-base md:text-right text-white">${match.team1}</div>
                                <div class="order-first md:order-none">${scoreHTML}</div>
                                <div class="font-bold text-base md:text-left text-white">${match.team2}</div>
                            </div>
                            <div class="text-center w-full sm:w-28 border-t sm:border-t-0 sm:border-l border-gray-700 mt-3 sm:mt-0 ml-0 sm:ml-4 pt-3 sm:pt-0 pl-0 sm:pl-4">
                                <div class="font-semibold text-sm">${match.time}</div>
                                <div class="text-xs text-gray-500">Cancha ${match.court}</div>
                                <div class="text-xs ${match.completed ? 'text-green-500' : 'text-blue-500'} mt-1">${statusText}</div>
                            </div>`;
                        scheduleContainer.appendChild(matchElement);
                    });
                }
            }

            function renderKnockout() {
                knockoutContainer.innerHTML = '';
                let hasMatches = false;
                
                tournamentData.knockout.rounds.forEach(round => {
                    // Verificar si hay partidos en esta ronda
                    const hasRoundMatches = round.matches.some(match => match.team1 || match.team2);
                    if (!hasRoundMatches) return;
                    
                    hasMatches = true;
                    const roundElement = document.createElement('div');
                    roundElement.className = 'flex-1 mb-6 md:mb-0 fade-in';
                    
                    let matchesHTML = '';
                    round.matches.forEach(match => {
                        if (!match.team1 && !match.team2) return;
                        
                        const winnerClass = match.completed ? 
                            (match.score1 > match.score2 ? 'text-green-400 font-bold' : 'text-gray-300') : 'text-gray-300';
                        const loserClass = match.completed ? 
                            (match.score2 > match.score1 ? 'text-green-400 font-bold' : 'text-gray-300') : 'text-gray-300';
                            
                        matchesHTML += `
                            <div class="bg-gray-900 p-3 rounded-lg mb-2 border ${match.completed ? 'border-green-700' : 'border-gray-700'}">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="${winnerClass}">${match.team1 || 'Por definir'}</span>
                                    <span class="font-bold text-white bg-gray-700 px-2 rounded">${match.completed ? match.score1 : '-'}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="${loserClass}">${match.team2 || 'Por definir'}</span>
                                    <span class="font-bold text-white bg-gray-700 px-2 rounded">${match.completed ? match.score2 : '-'}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    roundElement.innerHTML = `
                        <h3 class="font-semibold text-lg text-center text-white mb-4 border-b border-gray-700 pb-2">${round.name}</h3>
                        <div class="space-y-2">
                            ${matchesHTML || '<div class="text-center text-gray-500 py-4">No hay partidos programados</div>'}
                        </div>
                    `;
                    knockoutContainer.appendChild(roundElement);
                });
                
                if (!hasMatches) {
                    knockoutContainer.innerHTML = '<div class="text-center text-gray-500 py-8 fade-in">La fase eliminatoria comenzará después de la fase de grupos</div>';
                }
            }

            function renderAdminMatches() {
                adminMatchesContainer.innerHTML = '';
                const pendingMatches = tournamentData.matches.filter(m => !m.completed);
                
                if (pendingMatches.length === 0) {
                     adminMatchesContainer.innerHTML = `<p class="text-center text-gray-400 py-4">¡No hay partidos pendientes!</p>`;
                     return;
                }

                pendingMatches.forEach((match) => {
                    const formElement = document.createElement('form');
                    formElement.className = 'bg-gray-900 border border-gray-700 p-4 rounded-lg flex flex-col md:flex-row items-center justify-between gap-4 fade-in';
                    formElement.dataset.matchId = match.id;
                    formElement.innerHTML = `
                        <div class="flex-1 text-center md:text-left">
                            <div class="font-semibold text-white">
                                <span class="block sm:inline">${match.team1}</span>
                                <span class="text-gray-400 mx-2 text-sm">vs</span>
                                <span class="block sm:inline">${match.team2}</span>
                            </div>
                            <div class="text-sm text-gray-500 mt-1">Grupo ${match.group} - Cancha ${match.court} @ ${match.time}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="number" name="score1" class="w-20 p-2 border bg-gray-700 border-gray-600 rounded-md text-center text-white" min="0" max="7" required>
                            <span class="text-gray-400">-</span>
                            <input type="number" name="score2" class="w-20 p-2 border bg-gray-700 border-gray-600 rounded-md text-center text-white" min="0" max="7" required>
                        </div>
                        <button type="submit" class="w-full md:w-auto bg-red-600 text-white font-bold px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">Guardar</button>`;
                    formElement.addEventListener('submit', handleMatchUpdate);
                    adminMatchesContainer.appendChild(formElement);
                });
            }
            
            function renderPlayersList() {
                playersList.innerHTML = '';
                
                let allPlayers = [];
                for (const groupName in tournamentData.groups) {
                    tournamentData.groups[groupName].forEach(team => {
                        allPlayers.push({...team, group: groupName});
                    });
                }
                
                if (allPlayers.length === 0) {
                    playersList.innerHTML = '<div class="text-center text-gray-500 py-4">No hay parejas registradas</div>';
                    return;
                }
                
                allPlayers.forEach(player => {
                    const playerElement = document.createElement('div');
                    playerElement.className = 'bg-gray-800 border border-gray-700 p-3 rounded-lg flex justify-between items-center fade-in';
                    playerElement.innerHTML = `
                        <div>
                            <div class="font-bold text-white">${player.name}</div>
                            <div class="text-sm text-gray-400">Grupo ${player.group} • ${player.players.join(' / ')}</div>
                        </div>
                        <button class="delete-player bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors" data-team="${player.name}">Eliminar</button>
                    `;
                    playersList.appendChild(playerElement);
                });
                
                // Agregar event listeners a los botones de eliminar
                document.querySelectorAll('.delete-player').forEach(button => {
                    button.addEventListener('click', function() {
                        const teamName = this.getAttribute('data-team');
                        deletePlayer(teamName);
                    });
                });
            }
            
            function populateGroupSelects() {
                // Limpiar selects
                const playerGroupSelect = document.getElementById('player-group');
                const matchGroupSelect = document.getElementById('new-match-group');
                
                playerGroupSelect.innerHTML = '<option value="">Seleccionar Grupo</option>';
                matchGroupSelect.innerHTML = '<option value="">Seleccionar Grupo</option>';
                
                // Agregar opciones de grupos
                for (const groupName in tournamentData.groups) {
                    const option1 = document.createElement('option');
                    option1.value = groupName;
                    option1.textContent = `Grupo ${groupName}`;
                    playerGroupSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = groupName;
                    option2.textContent = `Grupo ${groupName}`;
                    matchGroupSelect.appendChild(option2);
                }
            }
            
            function populateTeamSelects() {
                // Limpiar selects
                newMatchTeam1.innerHTML = '<option value="">Seleccionar Pareja</option>';
                newMatchTeam2.innerHTML = '<option value="">Seleccionar Pareja</option>';
                
                // Obtener todas las parejas del torneo
                const allTeams = [];
                for (const groupName in tournamentData.groups) {
                    tournamentData.groups[groupName].forEach(team => {
                        allTeams.push(team.name);
                    });
                }
                
                // Ordenar alfabéticamente y agregar a los selects
                allTeams.sort().forEach(team => {
                    const option1 = document.createElement('option');
                    option1.value = team;
                    option1.textContent = team;
                    newMatchTeam1.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = team;
                    option2.textContent = team;
                    newMatchTeam2.appendChild(option2);
                });
            }

            function handleMatchUpdate(e) {
                e.preventDefault();
                const matchId = parseInt(e.currentTarget.dataset.matchId);
                const score1 = parseInt(e.currentTarget.elements.score1.value);
                const score2 = parseInt(e.currentTarget.elements.score2.value);
                
                // Validar scores (en pádel generalmente se juega a 6 games)
                if (score1 < 0 || score2 < 0 || (score1 === 6 && score2 === 6)) {
                    alert('Resultado inválido. En pádel no puede haber empate 6-6.');
                    return;
                }
                
                const match = tournamentData.matches.find(m => m.id === matchId);
                if (match) {
                    match.score1 = score1;
                    match.score2 = score2;
                    match.completed = true;
                    
                    // Actualizar estadísticas del grupo
                    updateGroupStats(match.group, match.team1, match.team2, score1, score2);
                    
                    saveToLocalStorage();
                    renderAll();
                    alert('Resultado guardado exitosamente!');
                }
            }
            
            function updateGroupStats(groupName, team1, team2, score1, score2) {
                const group = tournamentData.groups[groupName];
                const team1Data = group.find(t => t.name === team1);
                const team2Data = group.find(t => t.name === team2);
                
                if (team1Data && team2Data) {
                    // Actualizar partidos jugados
                    team1Data.PJ += 1;
                    team2Data.PJ += 1;
                    
                    // Actualizar games a favor y en contra
                    team1Data.GF += score1;
                    team1Data.GC += score2;
                    team2Data.GF += score2;
                    team2Data.GC += score1;
                    
                    // Actualizar diferencia de games
                    team1Data.DG = team1Data.GF - team1Data.GC;
                    team2Data.DG = team2Data.GF - team2Data.GC;
                    
                    // Determinar ganador y actualizar PG/PP
                    if (score1 > score2) {
                        team1Data.PG += 1;
                        team2Data.PP += 1;
                        team1Data.Pts += 3;
                    } else {
                        team2Data.PG += 1;
                        team1Data.PP += 1;
                        team2Data.Pts += 3;
                    }
                }
            }
            
            function handleAddMatch(e) {
                e.preventDefault();
                
                const group = newMatchGroup.value;
                const team1 = newMatchTeam1.value;
                const team2 = newMatchTeam2.value;
                const court = document.getElementById('new-match-court').value;
                const time = document.getElementById('new-match-time').value;
                
                if (team1 === team2) {
                    alert('No puede haber un partido entre la misma pareja.');
                    return;
                }
                
                // Verificar si el partido ya existe
                const existingMatch = tournamentData.matches.find(m => 
                    m.group === group && 
                    ((m.team1 === team1 && m.team2 === team2) || (m.team1 === team2 && m.team2 === team1))
                );
                
                if (existingMatch) {
                    alert('Este partido ya existe en el grupo seleccionado.');
                    return;
                }
                
                // Crear nuevo partido
                const newMatchId = tournamentData.matches.length > 0 ? 
                    Math.max(...tournamentData.matches.map(m => m.id)) + 1 : 1;
                const newMatch = {
                    id: newMatchId,
                    group: group,
                    team1: team1,
                    score1: null,
                    team2: team2,
                    score2: null,
                    time: time,
                    court: parseInt(court),
                    completed: false
                };
                
                tournamentData.matches.push(newMatch);
                saveToLocalStorage();
                renderAll();
                addMatchForm.reset();
                alert('Partido agregado exitosamente!');
            }
            
            function handleAddPlayer(e) {
                e.preventDefault();
                
                const player1 = document.getElementById('player1-name').value.trim();
                const player2 = document.getElementById('player2-name').value.trim();
                const teamName = document.getElementById('team-name').value.trim();
                const group = document.getElementById('player-group').value;
                
                if (!player1 || !player2 || !teamName || !group) {
                    alert('Por favor, complete todos los campos.');
                    return;
                }
                
                // Verificar si la pareja ya existe
                const existingTeam = Object.values(tournamentData.groups).flat().find(t => t.name === teamName);
                if (existingTeam) {
                    alert('Ya existe una pareja con ese nombre.');
                    return;
                }
                
                // Crear nueva pareja
                const newTeam = {
                    name: teamName,
                    players: [player1, player2],
                    PJ: 0,
                    PG: 0,
                    PP: 0,
                    GF: 0,
                    GC: 0,
                    DG: 0,
                    Pts: 0
                };
                
                tournamentData.groups[group].push(newTeam);
                saveToLocalStorage();
                renderAll();
                renderPlayersList();
                populateTeamSelects();
                addPlayerForm.reset();
                alert('Pareja agregada exitosamente!');
            }
            
            function deletePlayer(teamName) {
                if (confirm(`¿Está seguro de que desea eliminar a la pareja "${teamName}"?`)) {
                    for (const groupName in tournamentData.groups) {
                        tournamentData.groups[groupName] = tournamentData.groups[groupName].filter(team => team.name !== teamName);
                    }
                    
                    // También eliminar partidos relacionados
                    tournamentData.matches = tournamentData.matches.filter(match => 
                        match.team1 !== teamName && match.team2 !== teamName
                    );
                    
                    saveToLocalStorage();
                    renderAll();
                    renderPlayersList();
                    populateTeamSelects();
                    alert('Pareja eliminada exitosamente!');
                }
            }
            
            function handlePlayerSearch() {
                const searchTerm = playerSearch.value.trim().toLowerCase();
                
                if (searchTerm === '') {
                    // Restaurar todos los grupos
                    document.querySelectorAll('.group-card').forEach(card => {
                        card.style.display = 'block';
                    });
                    return;
                }
                
                // Ocultar todos los grupos primero
                document.querySelectorAll('.group-card').forEach(card => {
                    card.style.display = 'none';
                });
                
                // Buscar en todos los grupos
                for (const groupName in tournamentData.groups) {
                    const group = tournamentData.groups[groupName];
                    const found = group.some(team => 
                        team.name.toLowerCase().includes(searchTerm) || 
                        team.players.some(player => player.toLowerCase().includes(searchTerm))
                    );
                    
                    if (found) {
                        document.getElementById(`group-${groupName}`).style.display = 'block';
                        
                        // Resaltar el término buscado en los nombres
                        const teamElements = document.querySelectorAll(`#group-${groupName} .bg-gray-900`);
                        teamElements.forEach(element => {
                            const teamName = element.querySelector('.font-bold').textContent;
                            if (teamName.toLowerCase().includes(searchTerm)) {
                                const highlightedName = teamName.replace(
                                    new RegExp(searchTerm, 'gi'), 
                                    match => `<span class="search-highlight">${match}</span>`
                                );
                                element.querySelector('.font-bold').innerHTML = highlightedName;
                            }
                        });
                    }
                }
            }
            
            function generateGroupsAutomatically() {
                // Obtener todas las parejas
                let allTeams = [];
                for (const groupName in tournamentData.groups) {
                    allTeams = allTeams.concat(tournamentData.groups[groupName]);
                }
                
                if (allTeams.length === 0) {
                    alert('No hay parejas para distribuir en grupos.');
                    return;
                }
                
                // Limpiar grupos actuales
                for (const groupName in tournamentData.groups) {
                    tournamentData.groups[groupName] = [];
                }
                
                // Distribuir parejas en grupos (método round-robin simple)
                const groupNames = Object.keys(tournamentData.groups);
                allTeams.forEach((team, index) => {
                    const groupIndex = index % groupNames.length;
                    tournamentData.groups[groupNames[groupIndex]].push(team);
                });
                
                saveToLocalStorage();
                renderAll();
                renderPlayersList();
                populateTeamSelects();
                alert('Grupos generados automáticamente!');
            }
            
            function generateKnockoutStage() {
                // Obtener los primeros de cada grupo
                const groupWinners = [];
                for (const groupName in tournamentData.groups) {
                    const group = tournamentData.groups[groupName];
                    if (group.length > 0) {
                        // Ordenar por puntos y diferencia
                        const sorted = [...group].sort((a, b) => {
                            if (b.Pts !== a.Pts) return b.Pts - a.Pts;
                            return b.DG - a.DG;
                        });
                        groupWinners.push(sorted[0]);
                    }
                }
                
                if (groupWinners.length < 2) {
                    alert('Se necesitan al menos 2 parejas para generar la fase eliminatoria.');
                    return;
                }
                
                // Limpiar fase eliminatoria actual
                tournamentData.knockout.rounds.forEach(round => {
                    round.matches = [];
                });
                
                // Generar octavos de final (si hay suficientes equipos)
                if (groupWinners.length >= 8) {
                    for (let i = 0; i < 8; i += 2) {
                        tournamentData.knockout.rounds[0].matches.push({
                            team1: groupWinners[i].name,
                            score1: null,
                            team2: groupWinners[i+1].name,
                            score2: null,
                            completed: false
                        });
                    }
                }
                // O generar cuartos de final directamente
                else if (groupWinners.length >= 4) {
                    for (let i = 0; i < 4; i += 2) {
                        tournamentData.knockout.rounds[1].matches.push({
                            team1: groupWinners[i].name,
                            score1: null,
                            team2: groupWinners[i+1].name,
                            score2: null,
                            completed: false
                        });
                    }
                }
                // O semifinales directamente
                else if (groupWinners.length >= 2) {
                    for (let i = 0; i < 2; i += 2) {
                        tournamentData.knockout.rounds[2].matches.push({
                            team1: groupWinners[i].name,
                            score1: null,
                            team2: groupWinners[i+1].name,
                            score2: null,
                            completed: false
                        });
                    }
                }
                
                saveToLocalStorage();
                renderAll();
                alert('Fase eliminatoria generada exitosamente!');
            }
            
            function resetTournament() {
                if (confirm('¿Está seguro de que desea reiniciar el torneo? Se perderán todos los datos.')) {
                    tournamentData = {
                        settings: {
                            name: 'Torneo de Pádel',
                            date: new Date().toISOString().split('T')[0],
                            courts: 4,
                            groups: 8
                        },
                        groups: {},
                        matches: [],
                        knockout: {
                            rounds: [
                                { name: 'Octavos de Final', matches: [] },
                                { name: 'Cuartos de Final', matches: [] },
                                { name: 'Semifinal', matches: [] },
                                { name: 'Final', matches: [] }
                            ]
                        }
                    };
                    
                    initializeGroups();
                    saveToLocalStorage();
                    renderAll();
                    renderPlayersList();
                    populateTeamSelects();
                    alert('Torneo reiniciado exitosamente!');
                }
            }
            
            function saveTournamentSettings() {
                tournamentData.settings.name = document.getElementById('tournament-name').value;
                tournamentData.settings.date = document.getElementById('tournament-date').value;
                tournamentData.settings.courts = parseInt(document.getElementById('court-count').value);
                tournamentData.settings.groups = parseInt(document.getElementById('group-count').value);
                
                // Re-inicializar grupos con la nueva configuración
                initializeGroups();
                
                saveToLocalStorage();
                renderAll();
                alert('Configuración guardada exitosamente!');
            }
            
            function exportTournamentData() {
                const dataStr = JSON.stringify(tournamentData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `torneo-${tournamentData.settings.name.replace(/\s+/g, '-').toLowerCase()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('Datos del torneo exportados exitosamente!');
            }
            
            function switchTab(tabName) {
                // Ocultar todos los contenidos de pestañas
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Remover clase activa de todas las pestañas
                document.querySelectorAll('nav button').forEach(tab => {
                    tab.classList.remove('tab-active', 'text-white');
                    tab.classList.add('text-gray-400');
                });
                
                // Mostrar contenido de la pestaña seleccionada
                document.getElementById(`tab-content-${tabName}`).classList.remove('hidden');
                
                // Marcar pestaña como activa
                document.getElementById(`tab-${tabName}`).classList.add('tab-active', 'text-white');
                document.getElementById(`tab-${tabName}`).classList.remove('text-gray-400');
            }
            
            // --- USER AUTH FUNCTIONS ---
            function showUserAuthModal() {
                userAuthModal.classList.remove('hidden');
                showLoginForm();
            }
            
            function hideUserAuthModal() {
                userAuthModal.classList.add('hidden');
                userLoginError.classList.add('hidden');
                userRegisterError.classList.add('hidden');
                loginUserForm.reset();
                registerUserForm.reset();
            }
            
            function showLoginForm() {
                userLoginForm.classList.remove('hidden');
                userRegisterForm.classList.add('hidden');
            }
            
            function showRegisterForm() {
                userLoginForm.classList.add('hidden');
                userRegisterForm.classList.remove('hidden');
            }
            
            function handleUserLogin(e) {
                e.preventDefault();
                const email = document.getElementById('user-email').value;
                const password = document.getElementById('user-password').value;
                
                // Buscar usuario
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    // Iniciar sesión
                    sessionStorage.setItem('currentUser', JSON.stringify(user));
                    updateUserUI();
                    hideUserAuthModal();
                    alert(`¡Bienvenido ${user.name}!`);
                } else {
                    userLoginError.classList.remove('hidden');
                }
            }
            
            function handleUserRegister(e) {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const passwordConfirm = document.getElementById('register-password-confirm').value;
                
                // Validaciones
                if (password !== passwordConfirm) {
                    userRegisterError.textContent = 'Las contraseñas no coinciden.';
                    userRegisterError.classList.remove('hidden');
                    return;
                }
                
                if (users.find(u => u.email === email)) {
                    userRegisterError.textContent = 'Ya existe un usuario con ese email.';
                    userRegisterError.classList.remove('hidden');
                    return;
                }
                
                // Crear nuevo usuario
                const newUser = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    password: password
                };
                
                users.push(newUser);
                saveToLocalStorage();
                
                // Iniciar sesión automáticamente
                sessionStorage.setItem('currentUser', JSON.stringify(newUser));
                updateUserUI();
                hideUserAuthModal();
                alert(`¡Cuenta creada exitosamente! Bienvenido ${name}`);
            }
            
            function updateUserUI() {
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                
                if (currentUser) {
                    userInfo.classList.remove('hidden');
                    userLoginBtn.classList.add('hidden');
                    userName.textContent = currentUser.name;
                    
                    // Obtener iniciales
                    const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    userInitials.textContent = initials;
                } else {
                    userInfo.classList.add('hidden');
                    userLoginBtn.classList.remove('hidden');
                }
            }
            
            function handleUserLogout() {
                sessionStorage.removeItem('currentUser');
                updateUserUI();
                alert('Sesión cerrada exitosamente.');
            }
            
            function renderAll() {
                renderTournamentOverview();
                renderGroups();
                renderSchedule();
                renderKnockout();
                renderAdminMatches();
                renderPlayersList();
                populateGroupSelects();
                populateTeamSelects();
                updateUserUI();
                
                // Actualizar configuración en la interfaz
                document.getElementById('tournament-name').value = tournamentData.settings.name;
                document.getElementById('tournament-date').value = tournamentData.settings.date;
                document.getElementById('court-count').value = tournamentData.settings.courts;
                document.getElementById('group-count').value = tournamentData.settings.groups;
            }

            // --- AUTH & MODAL LOGIC ---
            function showLoginModal() { 
                loginModal.classList.remove('hidden'); 
            }
            
            function hideLoginModal() {
                loginError.classList.add('hidden');
                loginForm.reset();
                loginModal.classList.add('hidden');
            }

            adminLoginBtn.addEventListener('click', showLoginModal);
            closeModalBtn.addEventListener('click', hideLoginModal);
            loginModal.addEventListener('click', (e) => { 
                if (e.target === loginModal) hideLoginModal(); 
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = e.currentTarget.elements.username.value;
                const password = e.currentTarget.elements.password.value;

                if (username === 'admin' && password === 'matchpoint') {
                    hideLoginModal();
                    adminView.classList.remove('hidden');
                    adminLoginBtn.classList.add('hidden');
                    logoutBtn.classList.remove('hidden');
                } else {
                    loginError.classList.remove('hidden');
                }
            });

            logoutBtn.addEventListener('click', () => {
                adminView.classList.add('hidden');
                adminLoginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            });
            
            // --- USER AUTH EVENT LISTENERS ---
            userLoginBtn.addEventListener('click', showUserAuthModal);
            closeUserModalBtn.addEventListener('click', hideUserAuthModal);
            userAuthModal.addEventListener('click', (e) => {
                if (e.target === userAuthModal) hideUserAuthModal();
            });
            goToRegister.addEventListener('click', showRegisterForm);
            goToLogin.addEventListener('click', showLoginForm);
            loginUserForm.addEventListener('submit', handleUserLogin);
            registerUserForm.addEventListener('submit', handleUserRegister);
            userLogout.addEventListener('click', handleUserLogout);
            
            // --- EVENT LISTENERS ---
            addMatchForm.addEventListener('submit', handleAddMatch);
            addPlayerForm.addEventListener('submit', handleAddPlayer);
            playerSearch.addEventListener('input', handlePlayerSearch);
            generateGroupsBtn.addEventListener('click', generateGroupsAutomatically);
            generateKnockoutBtn.addEventListener('click', generateKnockoutStage);
            resetTournamentBtn.addEventListener('click', resetTournament);
            saveTournamentSettingsBtn.addEventListener('click', saveTournamentSettings);
            exportTournamentBtn.addEventListener('click', exportTournamentData);
            
            // Tab switching
            tabMatches.addEventListener('click', () => switchTab('matches'));
            tabPlayers.addEventListener('click', () => switchTab('players'));
            tabTournament.addEventListener('click', () => switchTab('tournament'));

            // --- INITIALIZATION ---
            loadFromLocalStorage();
            renderAll();
        });
    </script>
</body>
</html>
